<!--
    Mobile Bottom Navigation Bar
    A fixed, docked navigation bar with split-action capsule design.
    Features glassmorphism styling and HTMX integration for seamless navigation.
    
    Modules:
    - Sales: View list / Add new
    - Expenses (Expns): View list / Add new
    - Batches: View list / Add new
    - Statistics (Stats): View only (no add action)
-->

<nav class="bottom-nav lg:hidden" aria-label="Quick actions">
    <div class="bottom-nav-container">
        <!-- Sales Capsule -->
        <div class="bottom-nav-capsule {% if request.resolver_match.app_name == 'sales' %}active{% endif %}" data-nav-app="sales">
            <a href="{% url 'sales:list' %}" 
               hx-get="{% url 'sales:list' %}" 
               hx-target="#main-content" 
               hx-push-url="true"
               class="capsule-main"
               aria-label="View Sales">
                <i data-lucide="shopping-cart" class="capsule-icon"></i>
                <span class="capsule-label">Sales</span>
            </a>
            <a href="{% url 'sales:create' %}" 
               hx-get="{% url 'sales:create' %}" 
               hx-target="#main-content" 
               hx-push-url="true"
               class="capsule-add"
               aria-label="Add new sale">
                <span class="add-btn"><i data-lucide="plus" class="add-icon"></i></span>
            </a>
        </div>

        <!-- Expenses Capsule -->
        <div class="bottom-nav-capsule {% if request.resolver_match.app_name == 'expenses' %}active{% endif %}" data-nav-app="expenses">
            <a href="{% url 'expenses:list' %}" 
               hx-get="{% url 'expenses:list' %}" 
               hx-target="#main-content" 
               hx-push-url="true"
               class="capsule-main"
               aria-label="View Expenses">
                <i data-lucide="receipt" class="capsule-icon"></i>
                <span class="capsule-label">Expns</span>
            </a>
            <a href="{% url 'expenses:create' %}" 
               hx-get="{% url 'expenses:create' %}" 
               hx-target="#main-content" 
               hx-push-url="true"
               class="capsule-add"
               aria-label="Add new expense">
                <span class="add-btn"><i data-lucide="plus" class="add-icon"></i></span>
            </a>
        </div>

        <!-- Batches Capsule -->
        <div class="bottom-nav-capsule {% if request.resolver_match.app_name == 'batches' %}active{% endif %}" data-nav-app="batches">
            <a href="{% url 'batches:list' %}" 
               hx-get="{% url 'batches:list' %}" 
               hx-target="#main-content" 
               hx-push-url="true"
               class="capsule-main"
               aria-label="View Batches">
                <i data-lucide="package" class="capsule-icon"></i>
                <span class="capsule-label">Batches</span>
            </a>
            <a href="{% url 'batches:create' %}" 
               hx-get="{% url 'batches:create' %}" 
               hx-target="#main-content" 
               hx-push-url="true"
               class="capsule-add"
               aria-label="Add new batch">
                <span class="add-btn"><i data-lucide="plus" class="add-icon"></i></span>
            </a>
        </div>

        <!-- Statistics Capsule (View Only) -->
        <div class="bottom-nav-capsule stats-only {% if request.resolver_match.app_name == 'reports' %}active{% endif %}" data-nav-app="reports">
            <a href="{% url 'reports:statistics' %}" 
               hx-get="{% url 'reports:statistics' %}" 
               hx-target="#main-content" 
               hx-push-url="true"
               class="capsule-main capsule-full"
               aria-label="View Statistics">
                <i data-lucide="bar-chart-3" class="capsule-icon"></i>
                <span class="capsule-label">Stats</span>
            </a>
        </div>
    </div>
</nav>

<script>
(function() {
    // Map URL patterns to app names
    const urlToApp = {
        '/sales/': 'sales',
        '/expenses/': 'expenses',
        '/batches/': 'batches',
        '/reports/': 'reports',
        '/statistics': 'reports'
    };

    function getAppFromUrl(url) {
        for (const [pattern, app] of Object.entries(urlToApp)) {
            if (url.includes(pattern)) {
                return app;
            }
        }
        return null;
    }

    function updateActiveNav() {
        const currentPath = window.location.pathname;
        const currentApp = getAppFromUrl(currentPath);
        
        document.querySelectorAll('.bottom-nav-capsule').forEach(capsule => {
            const capsuleApp = capsule.dataset.navApp;
            if (capsuleApp === currentApp) {
                capsule.classList.add('active');
            } else {
                capsule.classList.remove('active');
            }
        });
    }

    // Update on HTMX navigation
    document.body.addEventListener('htmx:afterSettle', function(event) {
        updateActiveNav();
        // Re-initialize Lucide icons if needed
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    });

    // Also handle browser back/forward buttons
    window.addEventListener('popstate', updateActiveNav);

    // Initial check on page load
    document.addEventListener('DOMContentLoaded', updateActiveNav);
})();
</script>
